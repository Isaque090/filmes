<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Assistir Filme</title>
    <style>
        /* Regras de proteﾃｧﾃ｣o do Overlay */
        .iframe-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: auto;
            cursor: default;
            background: transparent;
        }

        /* Regra para esconder o overlay e permitir a interaﾃｧﾃ｣o com o player */
        .iframe-overlay.hidden {
            pointer-events: none;
            cursor: auto;
        }

        body {
            background-color: #000;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }

        .navbar {
            background-color: rgba(255, 255, 255, 0.733);
            backdrop-filter: blur(6px);
            padding: 8px 15px;
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            margin-top: 20px;
            height: 0;
            overflow: hidden;
            background: #111;
            border-radius: 5px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        #movie-details {
            background-color: #1a1a1b;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: #fff;
        }

        #movie-details h1 {
            color: #ff0;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        #movie-details p {
            font-size: 1rem;
            margin-bottom: 10px;
        }

        #movie-poster {
            border-radius: 20px;
            margin-right: 20px;
            max-width: 200px;
        }

        .details-content {
            flex: 1;
            min-width: 200px;
        }

        .switch-player-btn {
            margin-top: 10px;
            background-color: #ff0;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        .switch-player-btn:hover {
            background-color: #e6e600;
        }

        .favorite-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .favorite-icon {
            cursor: pointer;
            color: #fff;
            font-size: 24px;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .favorite-icon.favorited {
            color: #ff0000;
            font-variation-settings: 'FILL' 1;
        }

        .favorite-icon:hover {
            color: #ff5555;
            transform: scale(1.2);
        }

        .custom-modal-horizontal {
            margin: 1rem auto;
            max-width: 35vw;
        }

        .custom-modal-horizontal .modal-content {
            max-height: auto;
            overflow-y: auto;
            border-radius: 8px;
            margin-top: -3%;
        }

        @media (max-width: 576px) {
            .custom-modal-horizontal {
                max-width: 95vw;
                margin-left: 18%;
            }

            .custom-modal-horizontal .modal-content {
                max-height: 60vh;
            }

            #movie-details h1 {
                font-size: 1.5rem;
            }

            #movie-details p {
                font-size: 0.9rem;
            }

            #movie-poster {
                margin: 0 auto 15px;
                display: block;
                max-width: 150px;
            }

            .details-content {
                text-align: center;
            }

            .favorite-icon {
                font-size: 20px;
            }

            .switch-player-btn {
                font-size: 0.9rem;
                padding: 6px 12px;
            }
        }

        footer {
            background-color: #373434;
            width: 100%;
            padding: 1rem 0;
            text-align: center;
            margin-top: auto;
        }

        .flex-grow-1 {
            flex-grow: 1;
            padding-bottom: 1rem;
        }

        .toopo {
            margin-top: 100px;
        }

        .span:hover {
            transform: scale(1.10);
        }

        button {
            outline: none;
        }

        button:focus {
            outline: none;
        }

        .btn:focus,
        .btn.focus {
            box-shadow: none !important;
        }

        .a:hover {
            transform: scale(1.15);
            transition: 0.50s ease;
        }
     .container {
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .controls {
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <nav class="navbar navbar-light navbar-expand-lg fixed-top">
            <a class="navbar-brand" href="#">
                <h3 style="color: #ff0000; margin: 0;">Gratis</h3>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav1" aria-controls="nav1"
                aria-expanded="false" aria-label="Alternar menu de navegaﾃｧﾃ｣o">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="nav1">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a href="index.html" class="nav-link" style="color: #4a4a4a;">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" style="color: #4a4a4a;">Contato</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>

    <div class="flex-grow-1">
        <div class="container toopo">
              <div class="controls">
        <!-- BOTﾃグ FORA DO IFRAME -->
        <button class="switch-player-btn" onclick="mudarCor(this)" id="sandbox-btn" style="background-color: #ff0;" data-cor-atual="original">
    Recarregar Player (Sandbox)
</button>

    </div>
    
            <div class="card mt-3 video-container">
                <div class="card-body">
                    <div id="player-overlay" class="iframe-overlay"></div>

                    <iframe id="ve-iframe" src="" frameborder="0" 
                        allowfullscreen webkitallowfullscreen mozallowfullscreen
                        
                        allow="fullscreen; popups 'none'; top-navigation 'none'"
                                sandbox="allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation">

                    
                    </iframe>

                    
                </div>
            </div>
            

            <div class="favorite-container">
                <span class="material-symbols-outlined favorite-icon" id="favorite-icon" onclick="toggleFavorite()"
                    aria-label="Adicionar ou remover dos favoritos">favorite</span>
                <button class="switch-player-btn" onclick="switchPlayer()">Trocar Player</button>
                <span class="material-symbols-outlined a" style="color: #e6e600; cursor: pointer;" data-toggle="modal"
                    data-target="#modalExemplo">
                    info
                </span>
            </div>

            <div class="container mt-3">
                <div id="movie-details" class="card text-white">
                    <div class="card-body d-flex flex-wrap">
                        <img id="movie-poster" src="" alt="" class="img-fluid rounded mb-3" style="max-width: 200px; display: none;">
                        <div class="details-content">
                            <h1 id="movie-title" class="card-title">Buscando detalhes do filme...</h1>
                            <p id="movie-year" class="card-text"><strong>Ano:</strong> Carregando...</p>
                            <p id="movie-genres" class="card-text"><strong>Gﾃｪneros:</strong> Carregando...</p>
                            <p id="movie-runtime" class="card-text"><strong>Duraﾃｧﾃ｣o:</strong> Carregando...</p>
                            <p id="movie-rating" class="card-text"><strong>Nota:</strong> Carregando...</p>
                            <p id="movie-overview" class="card-text"><strong>Sinopse:</strong> Carregando...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalExemplo" tabindex="-1" role="dialog" data-backdrop="false" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog custom-modal-horizontal" role="document">
            <div class="modal-content">
                <div class="modal-header py-2 px-3">
                    <h6 class="modal-title mb-0" id="exampleModalLabel">Ajuda rﾃ｡pida</h6>
                </div>
                <div class="modal-body p-3" style="font-size: 0.85rem;">
                    <p><strong>Trocar Player</strong> muda o servidor de vﾃｭdeo, caso o atual nﾃ｣o funcione bem.</p>
                </div>
                <div class="modal-footer py-2 px-3">
                    <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal" style="padding: 1%;width:50px;">OK</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <small class="text-secondary">&copy; 2025 Todos os direitos reservados.</small>
        </div>
    </footer>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      const original = '#ff0';
const mudar = '#3498db';

function mudarCor(botao) {
    // Verifica o estado atual usando o atributo de dados
    if (botao.getAttribute('data-cor-atual') === 'original') {
        botao.style.backgroundColor = mudar;
        botao.setAttribute('data-cor-atual', 'mudar'); // Atualiza o estado
    } else {
        botao.style.backgroundColor = original;
        botao.setAttribute('data-cor-atual', 'original'); // Atualiza o estado
    }
}

  
// ======================================================
// BOTﾃグ FORA DO IFRAME: REMOVE/RESTAURA SANDBOX + RECARREGA
// ======================================================
document.addEventListener("DOMContentLoaded", function () {
    const botao = document.getElementById("sandbox-btn");
    const iframe = document.getElementById("ve-iframe");

    // Permissﾃｵes originais do sandbox
    const PERMISSOES_ORIGINAIS = "allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation";

    botao.addEventListener("click", function () {
        const urlAtual = iframe.src;

        // 1. Remove o sandbox temporariamente
        iframe.removeAttribute("sandbox");
        console.log("Sandbox removido temporariamente");

        // 2. Forﾃｧa o recarregamento
        iframe.contentWindow.location.href = urlAtual;

        // 3. Restaura o sandbox apﾃｳs um pequeno delay (necessﾃ｡rio)
        setTimeout(() => {
            iframe.setAttribute("sandbox", PERMISSOES_ORIGINAIS);
            console.log("Sandbox restaurado com seguranﾃｧa");
        }, 100);
    });
});
</script>
    <script>
        const playerOverlay = document.getElementById('player-overlay');
        const iframe = document.getElementById('ve-iframe');
        
        // Variﾃ｡vel para gerenciar o timeout de reativaﾃｧﾃ｣o do overlay
        let overlayTimeoutId = null; 

        // =========================================================
        // === 圷 DETECﾃﾃグ DE PERDA DE FOCO (OTIMIZADA) ===
        // Reativa a proteﾃｧﾃ｣o silenciosamente, sem modal, apﾃｳs um clique no iframe
        // =========================================================
        window.addEventListener('blur', function() {
            // Se o overlay ESTIVER oculto, significa que o clique foi direto no player/anﾃｺncio.
            if (playerOverlay && playerOverlay.classList.contains('hidden')) {
                
                console.warn("Foco perdido detectado! Forﾃｧando reativaﾃｧﾃ｣o imediata da proteﾃｧﾃ｣o.");
                
                // Reativa o overlay Imediatamente, forﾃｧando o prﾃｳximo clique a ser interceptado.
                clearTimeout(overlayTimeoutId);
                playerOverlay.classList.remove('hidden');
                iframe.style.cursor = 'default';
            }
        });
        
        // =========================================================
        // === FUNﾃﾃグ DE CLIQUE NO OVERLAY (5 SEGUNDOS) ===
        // A proteﾃｧﾃ｣o JS que intercepta o primeiro clique
        // =========================================================
        if (playerOverlay) {
            playerOverlay.addEventListener('click', function() {
                // 1. Limpa qualquer timeout anterior 
                clearTimeout(overlayTimeoutId);
                
                // 2. Esconde o overlay, permitindo que o clique passe para o player
                playerOverlay.classList.add('hidden');
                iframe.style.cursor = 'pointer'; 
                
                console.log('Overlay desativado. Proteﾃｧﾃ｣o reativarﾃ｡ em 5 segundos.');

                // 3. Define um timeout para reativar o overlay apﾃｳs 5 segundos
                overlayTimeoutId = setTimeout(() => {
                    if (playerOverlay && playerOverlay.classList.contains('hidden')) {
                        playerOverlay.classList.remove('hidden');
                        iframe.style.cursor = 'default';
                        console.log('Overlay reativado apﾃｳs 5 segundos para nova proteﾃｧﾃ｣o.');
                    }
                }, 5000); // 5000 milissegundos = 5 segundos
            });
        }

        const TMDB_API_KEY = 'e213742dac5f2f6cd11f3f89bae08c2b';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const urlParams = new URLSearchParams(window.location.search);
        const filmeId = urlParams.get('filme'); // Este ﾃｩ o IMDb ID (ex: tt1234567)
        const playerType = urlParams.get('player');
        
        const movieTitle = document.getElementById('movie-title');
        const movieYear = document.getElementById('movie-year');
        const movieGenres = document.getElementById('movie-genres');
        const movieRuntime = document.getElementById('movie-runtime');
        const movieRating = document.getElementById('movie-rating');
        const movieOverview = document.getElementById('movie-overview');
        const moviePoster = document.getElementById('movie-poster');
        const favoriteIcon = document.getElementById('favorite-icon');
        const switchPlayerButton = document.querySelector('.switch-player-btn');

        let currentTmdbId = null;

        function createPlayerUrls(imdbId, tmdbId) {
            const idParaVicio = tmdbId || imdbId; 
            return {
                playerflix: `https://playerflixapi.com/filme/${imdbId}`,
                mega: `https://megaembed.com/embed/${imdbId}`,
                meg:`https://megaembed.com/embed/${idParaVicio}`,
                ultra: `https://ultraembed.fun/filme/${imdbId}`,
                vicio: `https://filmesss.netlify.app/embed/movie/${idParaVicio}`,
                super: `https://superflixapi.asia/filme/${imdbId}`
            };
        }

        async function getTMDbIdFromIMDb(imdbId) {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/find/${imdbId}?api_key=${TMDB_API_KEY}&language=pt-BR&external_source=imdb_id`);
                if (!response.ok) {
                    console.error(`Busca FIND falhou com status: ${response.status}`);
                    return null;
                }
                const data = await response.json();
                return data.movie_results && data.movie_results.length > 0 ? data.movie_results[0].id : null;
            } catch (error) {
                console.error("Falha ao obter TMDb ID:", error);
                return null;
            }
        }

        function isSafeUrl(url) {
            const safeDomains = ['playerflixapi.com', 'megaembed.com', 'ultraembed.fun', 'superflixapi.asia', 'filmesss.netlify.app'];
            try {
                const urlObj = new URL(url);
                return safeDomains.includes(urlObj.hostname);
            } catch (e) {
                return false;
            }
        }

        async function testPlayerLoad(url) {
            const TEST_TIMEOUT_MS = 3000;
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), TEST_TIMEOUT_MS);
                const response = await fetch(url, { method: 'HEAD', signal: controller.signal });
                clearTimeout(timeoutId);
                return response.ok ? url : null;
            } catch (error) {
                console.warn(`Falha ao testar ${url}:`, error.message);
                return null;
            }
        }

        function getCachedPlayer(filmeId) {
            return localStorage.getItem(`player_${filmeId}`);
        }

        function setCachedPlayer(filmeId, url) {
            localStorage.setItem(`player_${filmeId}`, url);
        }

        async function selectBestPlayer(imdbId, tmdbId) { 
            const cachedPlayer = getCachedPlayer(imdbId);
            if (cachedPlayer && isSafeUrl(cachedPlayer)) {
                console.log('Usando player do cache:', cachedPlayer);
                return cachedPlayer;
            }

            const urls = createPlayerUrls(imdbId, tmdbId);
            const userAgent = navigator.userAgent;
            const playerKeys = Object.keys(urls).filter(key => !urls[key].includes('megaembed') || !/mobile/i.test(userAgent));
            const GLOBAL_TIMEOUT_MS = 5000;

            const playerPromises = playerKeys.map(key =>
                Promise.race([
                    testPlayerLoad(urls[key]),
                    new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), GLOBAL_TIMEOUT_MS))
                ]).catch(e => {
                    console.warn(`Player ${key} falhou:`, e.message);
                    return null;
                })
            );

            const results = await Promise.all(playerPromises);
            const fastestUrl = results.find(url => url !== null);

            if (fastestUrl) {
                setCachedPlayer(imdbId, fastestUrl);
                return fastestUrl;
            }

            setCachedPlayer(imdbId, urls.playerflix);
            return urls.playerflix;
        }

        function switchPlayer() {
            const urls = createPlayerUrls(filmeId, currentTmdbId); 
            const playerKeys = Object.keys(urls);
            const currentUrl = iframe.src;
            const currentIndex = playerKeys.findIndex(key => urls[key] === currentUrl);
            const nextIndex = (currentIndex + 1) % playerKeys.length;
            let newUrl = urls[playerKeys[nextIndex]];
            let safetyCheckIndex = nextIndex;
            let originalIndex = currentIndex;
            let maxTries = playerKeys.length;
            let tries = 0;

            while (!isSafeUrl(newUrl) && tries < maxTries) {
                safetyCheckIndex = (safetyCheckIndex + 1) % playerKeys.length;
                newUrl = urls[playerKeys[safetyCheckIndex]];
                tries++;
                if (safetyCheckIndex === originalIndex) { 
                    break;
                }
            }

            if (isSafeUrl(newUrl) && newUrl !== currentUrl) {
                iframe.src = newUrl;
                setCachedPlayer(filmeId, newUrl);
                
                // Aﾃﾃグ DE PROTEﾃﾃグ: Limpa o timeout e reativa o overlay para proteger o novo player
                clearTimeout(overlayTimeoutId);
                playerOverlay.classList.remove('hidden');
                iframe.style.cursor = 'default';
                
                console.log('Trocado para player. Overlay reativado.');
            } else {
                alert('Nﾃ｣o foi possﾃｭvel trocar o player para uma URL segura ou apenas um player seguro disponﾃｭvel.');
                console.error('URL do player nﾃ｣o ﾃｩ segura ou sem alternativas seguras:', newUrl);
            }
        }

        function toggleFavorite() {
            if (!filmeId) {
                console.warn('Nenhum filmeId fornecido para favoritar.');
                return;
            }
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            if (favorites.includes(filmeId)) {
                favorites = favorites.filter(id => id !== filmeId);
                favoriteIcon.classList.remove('favorited');
            } else {
                favorites.push(filmeId);
                favoriteIcon.classList.add('favorited');
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        function checkFavoriteStatus() {
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            if (favorites.includes(filmeId)) {
                favoriteIcon.classList.add('favorited');
            } else {
                favoriteIcon.classList.remove('favorited');
            }
        }

        async function loadMovieAndPlayer() {
            if (!filmeId) {
                movieTitle.textContent = 'Erro';
                movieYear.innerHTML = '<strong>Ano:</strong> ID do filme nﾃ｣o fornecido na URL.';
                movieGenres.innerHTML = '<strong>Gﾃｪneros:</strong> N/A';
                movieRuntime.innerHTML = '<strong>Duraﾃｧﾃ｣o:</strong> N/A';
                movieRating.innerHTML = '<strong>Nota:</strong> N/A';
                movieOverview.innerHTML = '<strong>Sinopse:</strong> ID do filme nﾃ｣o fornecido na URL.';
                moviePoster.style.display = 'none';
                checkFavoriteStatus();
                return;
            }

            if (filmeId.startsWith('tt')) {
                currentTmdbId = await getTMDbIdFromIMDb(filmeId);
            }

            if (currentTmdbId) {
                try {
                    const response = await fetch(`${TMDB_BASE_URL}/movie/${currentTmdbId}?api_key=${TMDB_API_KEY}&language=pt-BR`);
                    if (response.ok) {
                        const movieDetails = await response.json();
                        const titulo = movieDetails.title || "Tﾃｭtulo Indisponﾃｭvel";
                        const sinopse = movieDetails.overview || "Sinopse nﾃ｣o fornecida.";
                        const ano = movieDetails.release_date ? movieDetails.release_date.split('-')[0] : "N/A";
                        const generos = movieDetails.genres && movieDetails.genres.length > 0 
                            ? movieDetails.genres.map(g => g.name).join(', ') 
                            : "N/A";
                        const duracao = movieDetails.runtime ? `${movieDetails.runtime} min` : "N/A";
                        const nota = movieDetails.vote_average ? movieDetails.vote_average.toFixed(1) : "N/A";
                        const posterPath = movieDetails.poster_path ? `https://image.tmdb.org/t/p/w300${movieDetails.poster_path}` : '';

                        movieTitle.textContent = titulo;
                        movieYear.innerHTML = `<strong>Ano:</strong> ${ano}`;
                        movieGenres.innerHTML = `<strong>Gﾃｪneros:</strong> ${generos}`;
                        movieRuntime.innerHTML = `<strong>Duraﾃｧﾃ｣o:</strong> ${duracao}`;
                        movieRating.innerHTML = `<strong>Nota:</strong> ${nota}/10`;
                        movieOverview.innerHTML = `<strong>Sinopse:</strong> ${sinopse}`;
                        
                        if (posterPath) {
                            moviePoster.src = posterPath;
                            moviePoster.alt = `Pﾃｴster do filme ${titulo}`;
                            moviePoster.style.display = 'block';
                        } else {
                            moviePoster.style.display = 'none';
                        }
                    } else {
                        console.error('Erro ao buscar detalhes do filme (status):', response.status);
                    }
                } catch (error) {
                    console.error('Erro ao buscar detalhes do filme:', error);
                }
            } else {
                movieTitle.textContent = 'Detalhes Nﾃ｣o Encontrados';
                movieYear.innerHTML = '<strong>Ano:</strong> N/A';
                movieGenres.innerHTML = '<strong>Gﾃｪneros:</strong> N/A';
                movieRuntime.innerHTML = '<strong>Duraﾃｧﾃ｣o:</strong> N/A';
                movieRating.innerHTML = '<strong>Nota:</strong> N/A';
                movieOverview.innerHTML = '<strong>Sinopse:</strong> Nﾃ｣o foi possﾃｭvel reconhecer o filme ou ID invﾃ｡lido. Verifique se o ID ﾃｩ do IMDb (tt...).';
                moviePoster.style.display = 'none';
            }

            const urls = createPlayerUrls(filmeId, currentTmdbId);
            let playerUrl = '';
            
            if (playerType && urls[playerType] && isSafeUrl(urls[playerType])) {
                playerUrl = urls[playerType];
                console.log(`Usando player predefinido: ${playerType}`);
                setCachedPlayer(filmeId, playerUrl);
            } else {
                playerUrl = await selectBestPlayer(filmeId, currentTmdbId);
            }

            iframe.src = playerUrl;
            checkFavoriteStatus();
        }

        document.addEventListener('DOMContentLoaded', loadMovieAndPlayer);
    </script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5232119940373363"
     crossorigin="anonymous"></script>
</body>

</html>
